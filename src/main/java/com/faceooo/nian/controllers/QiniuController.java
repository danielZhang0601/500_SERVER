package com.faceooo.nian.controllers;import com.faceooo.nian.model.ImageDTO;import com.faceooo.nian.service.QiniuService;import com.faceooo.nian.service.SouvenirService;import com.faceooo.nian.utils.RestConstants;import org.apache.commons.lang3.StringUtils;import org.json.simple.JSONArray;import org.springframework.beans.factory.annotation.Autowired;import org.springframework.stereotype.Controller;import org.springframework.web.bind.annotation.RequestMapping;import org.springframework.web.bind.annotation.RequestParam;import org.springframework.web.bind.annotation.ResponseBody;import org.springframework.web.multipart.MultipartFile;import java.io.IOException;import java.util.HashMap;import java.util.List;import java.util.Map;/** * Created by yuanlin on 15/8/17. * 七牛图片云存储图片的名称为   userid-souid-imageid.jpg */@Controllerpublic class QiniuController {    @Autowired    QiniuService qiniuService;    @Autowired    SouvenirService souvenirService;    @RequestMapping(value = RestConstants.CREATE_IMAGE)    @ResponseBody    public JSONArray createimage(String userid,String souid,@RequestParam MultipartFile [] file) throws IOException {        JSONArray souSmallImagesJson = new JSONArray();        if(file!=null&&file.length!=0){            for(MultipartFile filename:file){                System.out.println(filename.getOriginalFilename());                ImageDTO imagedto=souvenirService.createImages(userid,souid);                System.out.println(imagedto.getId());                if(imagedto!=null){                    if(StringUtils.isNotEmpty(imagedto.getId())){                        String qiniuImageName = userid+"-"+souid+"-"+imagedto.getId();                        qiniuService.uploadToQiniu(filename.getBytes(),qiniuImageName);                        qiniuService.getImageURL(imagedto);                    }                }                souSmallImagesJson.add(imagedto.getDtoToJson());            }        }        return souSmallImagesJson;    }    @RequestMapping(value = RestConstants.GET_IMAGE_URL)    @ResponseBody    public JSONArray getSouSmallImagesList(String souid,String userid){        Map paramMap = new HashMap<String ,String>();        paramMap.put("souid",souid);        paramMap.put("userid",userid);        List<ImageDTO> souSmallImages = qiniuService.getSouSmallImagesList(paramMap);        JSONArray souSmallImagesJson = new JSONArray();        if(souSmallImages!=null){            for(ImageDTO imageDTO : souSmallImages){                souSmallImagesJson.add(imageDTO.getDtoToJson());            }        }        return souSmallImagesJson;    }}